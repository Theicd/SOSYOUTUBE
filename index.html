<!DOCTYPE html>
<html lang="he">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>קלטות דיגיטליות לרכב</title>
	<link href="css/player.css" type="text/css" rel="stylesheet">
	<link href="css/account.css" type="text/css" rel="stylesheet">
</head>
<body class="cassette-app">
    <!-- Cascade: מעטפת יישום הקלטות הדיגיטליות -->
    <header class="topbar" id="topbar">
        <div class="topbar-inner">
            <div class="topbar-logo" role="button" tabindex="0" aria-label="SOSMTV">
                <span class="topbar-logo-icon" aria-hidden="true">🎵</span>
                <span class="topbar-logo-text">SOSMTV</span>
            </div>
            <nav class="topbar-actions" aria-label="תפריט חשבון">
                <button id="signupButton" class="topbar-button topbar-button-primary" type="button">✨ צור משתמש</button>
                <button id="loginButton" class="topbar-button" type="button">🔐 התחבר</button>
                <button id="logoutButton" class="topbar-button" type="button" hidden>🚪 התנתק</button>
                <button id="topbarKey" class="topbar-icon-button" type="button" aria-haspopup="true" aria-expanded="false" aria-controls="topbarKeyMenu" aria-label="אפשרויות מפתח">
                    <span aria-hidden="true">🔑</span>
                </button>
            </nav>
        </div>
        <div id="topbarKeyMenu" class="topbar-key-menu" role="menu" aria-hidden="true">
            <div class="topbar-key-info" role="none">
                <span class="topbar-key-label">המפתח שלך</span>
                <code id="topbarKeyValue" class="topbar-key-value" tabindex="-1"></code>
            </div>
            <button id="topbarCopyKey" class="topbar-menu-btn" type="button" role="menuitem">העתק מפתח ציבורי</button>
            <button id="topbarLogout" class="topbar-menu-btn" type="button" role="menuitem">התנתק</button>
        </div>
    </header>

    <main class="cassette-shell">
        <section class="player-panel">
            <div class="player-screen" aria-label="נגן וידאו">
                <div id="player" class="player-frame"></div>
            </div>
            <div class="track-info" aria-live="polite">
                <div class="track-badge">LIVE MIX</div>
                <div class="track-title" id="trackTitle">אין מידע על רצועה</div>
                <div class="track-meta" id="trackMeta">התחל לנגן קלטת כדי לראות פרטים</div>
            </div>
            <div class="deck-status">
                <div class="player-status">
                    <span class="status-label">קלטת פעילה:</span>
                    <span id="currentPlaylistName" class="status-value">אין קלטת טעונה</span>
                </div>
                <div class="vu-meters" aria-hidden="true">
                    <div class="vu-meter">
                        <span class="vu-label">L</span>
                        <span class="vu-needle"></span>
                    </div>
                    <div class="vu-meter">
                        <span class="vu-label">R</span>
                        <span class="vu-needle"></span>
                    </div>
                </div>
            </div>
            <div class="control-row">
                <button class="control-btn tape-nav" onclick="buttonClickEffect(this); previousPlaylist()" type="button" title="קלטת קודמת">⏮️</button>
                <button class="control-btn track-nav" onclick="buttonClickEffect(this); previousTrack()" type="button" title="שיר קודם">⏮</button>
                <button class="control-btn play-toggle" onclick="buttonClickEffect(this); togglePlay()" type="button" title="נגן / עצור">▶</button>
                <button class="control-btn track-nav" onclick="buttonClickEffect(this); nextTrack()" type="button" title="שיר הבא">⏭</button>
                <button class="control-btn tape-nav" onclick="buttonClickEffect(this); nextPlaylist()" type="button" title="קלטת הבאה">⏭️</button>
                <button class="control-btn shuffle-btn" id="shuffleBtn" onclick="buttonClickEffect(this); toggleShuffle()" type="button" title="ערבוב">🔀</button>
            </div>
        </section>
        <section class="library-panel">
            <div class="library-header">
                <h2>ארון הקלטות</h2>
                <button id="openAddForm" class="ghost-btn" type="button">➕ קלטת חדשה</button>
            </div>
            <div class="cassette-shelf">
                <button class="shelf-nav" id="shelfPrev" type="button" title="גלול שמאלה">◀</button>
                <div id="cassetteCarousel" class="cassette-carousel" aria-live="polite" tabindex="0"></div>
                <button class="shelf-nav" id="shelfNext" type="button" title="גלול ימינה">▶</button>
            </div>
            <div id="emptyState" class="empty-state">עוד אין קלטות. הוסף קלטת חדשה כדי להתחיל להאזין.</div>
        </section>
    </main>

    <section id="addDrawer" class="add-drawer" aria-hidden="true">
        <div class="drawer-content" role="dialog" aria-modal="true" aria-labelledby="drawerTitle">
            <h3 id="drawerTitle">קלטת חדשה</h3>
            <p class="drawer-hint">שם הקלטת יילקח אוטומטית מיוטיוב מיד אחרי השמירה.</p>
            <label for="playlistIdInput" class="drawer-label">קישור או מזהה פלייליסט מיוטיוב</label>
            <input id="playlistIdInput" class="drawer-input" type="text" placeholder="הדבק כאן את הכתובת או המזהה">
            <p class="drawer-hint">Cascade: נשמור את הקלטת בזיכרון המכשיר כדי שתוכלו להאזין אליה מיידית בנסיעה.</p>
            <div class="drawer-actions">
                <button id="savePlaylist" class="primary-btn" type="button">שמירה</button>
                <button id="cancelAdd" class="ghost-btn" type="button">ביטול</button>
            </div>
        </div>
    </section>

    <section id="accountModal" class="account-modal" aria-hidden="true">
        <div class="account-dialog" role="dialog" aria-modal="true" aria-labelledby="accountModalTitle">
            <button id="closeAccountModal" class="account-close" type="button" aria-label="סגור חלון">✖</button>
            <h2 id="accountModalTitle">כניסה או רישום באמצעות מפתח אישי</h2>
            <p class="account-lead">Cascade: שמור את המפתח במקום בטוח. המפתח מזהה אותך ושומר את ארון הקלטות שלך בין מכשירים.</p>

            <div class="account-modal-grid">
                <section class="account-card account-card-login" aria-label="טופס כניסה">
                    <h3>📥 כניסה למפתח קיים</h3>
                    <p class="account-hint">הדבק את המפתח ושחזר מיד את הקלטות שלך.</p>
                    <label for="importKeyInput" class="account-label">מפתח nsec או Hex</label>
                    <textarea id="importKeyInput" class="account-textarea" rows="3" placeholder="לדוגמה nsec1..." maxlength="90"></textarea>
                    <div class="account-actions">
                        <button id="importKeyButton" class="primary-btn" type="button">התחבר</button>
                    </div>
                    <div id="importKeyStatus" class="account-status-inline" aria-live="polite"></div>
                </section>

                <section class="account-card account-card-signup" aria-label="טופס רישום">
                    <h3>🆕 יצירת פרופיל חדש</h3>
                    <p class="account-hint">בחר שם קצר, צור מפתח ושמור אותו במקום בטוח.</p>
                    <label for="profileNameInput" class="account-label">שם שיופיע במסך הפרופילים</label>
                    <input id="profileNameInput" class="account-input" type="text" placeholder="לדוגמה: נהג ראשי" maxlength="40">
                    <div id="profileNameStatus" class="account-status-inline" aria-live="polite"></div>
                    <div class="account-actions">
                        <button id="generateKeyButton" class="primary-btn" type="button">צור מפתח חדש</button>
                    </div>
                    <div id="generatedKeyBlock" class="generated-key" hidden>
                        <label for="generatedKeyOutput" class="account-label">המפתח שנוצר</label>
                        <textarea id="generatedKeyOutput" class="account-textarea" rows="3" readonly></textarea>
                        <div class="account-actions">
                            <button id="copyKeyButton" class="ghost-btn" type="button">העתק</button>
                            <button id="shareKeyButton" class="ghost-btn" type="button">WhatsApp</button>
                            <button id="confirmKeyButton" class="primary-btn" type="button">שמור והתחבר</button>
                        </div>
                        <div id="generatedKeyStatus" class="account-status-inline" aria-live="polite"></div>
                    </div>
                </section>
            </div>
        </div>
    </section>

    <section id="profileOverlay" class="profile-overlay" aria-hidden="true">
        <div class="profile-dialog" role="dialog" aria-modal="true" aria-labelledby="profileOverlayTitle">
            <h2 id="profileOverlayTitle">בחר משתמש לנגן</h2>
            <p class="profile-lead">Cascade: לכל אחד בבית יש מפתח אישי – בחר את הפרופיל שלך או הוסף חדש.</p>
            <div id="profileGrid" class="profile-grid" role="list"></div>
            <div class="profile-actions">
                <button id="addProfileButton" class="ghost-btn" type="button">➕ הוסף פרופיל חדש</button>
            </div>
        </div>
    </section>

    <script src="https://www.youtube.com/iframe_api"></script>
    <!-- Cascade: טעינת ספריית nostr-tools לשכבת הסנכרון המבוזר -->
    <script src="js/vendor/nostr.bundle.js"></script>
    <script src="js/player.js"></script>
</body>
</html>